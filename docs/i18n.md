# Frontend Internationalization (i18n) Documentation

## Overview

This React frontend implements a comprehensive internationalization system using `react-i18next` with TypeScript support. The system provides automatic language detection, persistent language preference, and seamless integration with components.

## Supported Languages

- **English (US)** - `en-US` - Default language
- **English (UK)** - `en-GB` - British English variant
- **Spanish (Spain)** - `es-ES` - European Spanish
- **Spanish (Mexico)** - `es-MX` - Mexican Spanish variant
- **French (France)** - `fr-FR` - European French
- **French (Canada)** - `fr-CA` - Canadian French variant
- **German (Germany)** - `de-DE` - Standard German
- **Portuguese (Brazil)** - `pt-BR` - Brazilian Portuguese
- **Portuguese (Portugal)** - `pt-PT` - European Portuguese

## Architecture

### File Structure

```text
src/
├── lib/
│   └── i18n.ts                 # i18n configuration
└── components/
    └── language-switcher.tsx   # Language selection component

public/
└── locales/                    # Translation files
    ├── en-US/
    │   └── translation.json    # US English translations
    ├── en-GB/
    │   └── translation.json    # UK English translations
    ├── es-ES/
    │   └── translation.json    # Spanish (Spain) translations
    ├── es-MX/
    │   └── translation.json    # Spanish (Mexico) translations
    ├── fr-FR/
    │   └── translation.json    # French (France) translations
    ├── fr-CA/
    │   └── translation.json    # French (Canada) translations
    ├── de-DE/
    │   └── translation.json    # German translations
    ├── pt-BR/
    │   └── translation.json    # Portuguese (Brazil) translations
    └── pt-PT/
        └── translation.json    # Portuguese (Portugal) translations
```

### Dependencies

```json
{
  "i18next": "^23.x.x",
  "react-i18next": "^13.x.x",
  "i18next-http-backend": "^2.x.x",
  "i18next-browser-languagedetector": "^7.x.x"
}
```

## Configuration

### i18n Setup (`src/lib/i18n.ts`)

```typescript
import i18n from 'i18next'
import Backend from 'i18next-http-backend'
import LanguageDetector from 'i18next-browser-languagedetector'
import { initReactI18next } from 'react-i18next'

i18n
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    fallbackLng: 'en',
    debug: import.meta.env.DEV,
    
    interpolation: {
      escapeValue: false, // React already escapes values
    },
    
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      caches: ['localStorage'],
    },
    
    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json',
    },
  })

export default i18n
```

### Language Detection Priority

The system detects language in this order:

1. **localStorage**: `i18nextLng` key (highest priority)
2. **navigator**: Browser language preference (with regional fallback)
3. **htmlTag**: `<html lang="">` attribute
4. **fallback**: `en-US` (default)

### Regional Fallback System

The system implements intelligent fallback for regional variants:

- `en-US` → `en-US` (exact match)
- `en-GB` → `en-GB` (exact match)  
- `en` → `en-US` (fallback to default regional variant)
- `pt-BR` → `pt-BR` (Brazilian Portuguese)
- `pt-PT` → `pt-PT` (European Portuguese)
- `pt` → `pt-BR` (fallback to primary regional variant)

### Translation File Structure

Each locale file follows this JSON structure:

```json
{
  "navigation": {
    "dashboard": "Dashboard",
    "organizations": "Organizations"
  },
  "auth": {
    "email": "Email",
    "password": "Password",
    "signIn": "Sign In",
    "emailRequired": "Email is required",
    "invalidCredentials": "Invalid email or password"
  },
  "common": {
    "loading": "Loading...",
    "save": "Save",
    "cancel": "Cancel"
  },
  "dashboard": {
    "welcome": "Welcome back, {{name}}!"
  }
}
```


## Usage in Components

### Enforced Default Text for Robust Fallback

> **Important:** All translation function calls must provide a default text as the second argument. This ensures robust fallback and prevents missing or blank UI text if a translation key is missing.

#### Example: Basic Translation (with default text)

```tsx
import { useTranslation } from 'react-i18next'

export function LoginForm() {
  const { t } = useTranslation()

  return (
    <form>
      <label>{t('auth.email', 'Email')}</label>
      <input placeholder={t('auth.emailPlaceholder', 'Enter your email')} />
      
      <label>{t('auth.password', 'Password')}</label>
      <input type="password" placeholder={t('auth.passwordPlaceholder', 'Enter your password')} />
      
      <button>{t('auth.signIn', 'Sign In')}</button>
    </form>
  )
}
```


### Translation with Variables (and default text)

```tsx
import { useTranslation } from 'react-i18next'

export function Dashboard({ userName }: { userName: string }) {
  const { t } = useTranslation()

  return (
    <div>
      <h1>{t('dashboard.welcome', 'Welcome back, {{name}}!', { name: userName })}</h1>
      <p>{t('dashboard.lastLogin', 'Last login: {{date}}', { date: new Date().toLocaleDateString() })}</p>
    </div>
  )
}
```


### Form Validation with i18n (with default text)

```tsx
import { z } from 'zod'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { useTranslation } from 'react-i18next'

export function UserForm() {
  const { t } = useTranslation()

  const formSchema = z.object({
    email: z.string().email({
      message: t('auth.emailInvalid', 'Invalid email address')
    }),
    password: z
      .string()
      .min(1, t('auth.passwordRequired', 'Password is required'))
      .min(8, t('auth.passwordTooShort', 'Password must be at least 8 characters')),
  })

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: '',
      password: '',
    },
  })

  // Form component JSX...
}
```

### Language Switching

```tsx
import { useTranslation } from 'react-i18next'

export function LanguageSwitcher() {
  const { i18n } = useTranslation()

  const changeLanguage = (lng: string) => {
    i18n.changeLanguage(lng)
  }

  return (
    <select 
      value={i18n.language} 
      onChange={(e) => changeLanguage(e.target.value)}
    >
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
      <option value="de">Deutsch</option>
      <option value="pt">Português</option>
    </select>
  )
}
```

### Conditional Rendering Based on Language

```tsx
import { useTranslation } from 'react-i18next'

export function CultureSpecificContent() {
  const { i18n } = useTranslation()

  return (
    <div>
      {i18n.language === 'en' && (
        <div>English-specific content</div>
      )}
      {i18n.language === 'es' && (
        <div>Contenido específico en español</div>
      )}
    </div>
  )
}
```

## Creating New Components with i18n

### 1. Basic Component Template

```tsx
import { useTranslation } from 'react-i18next'

interface MyComponentProps {
  // Define your props
}

export function MyComponent({ ...props }: MyComponentProps) {
  const { t } = useTranslation()

  return (
    <div>
      <h1>{t('myComponent.title')}</h1>
      <p>{t('myComponent.description')}</p>
    </div>
  )
}
```

### 2. Add Translations to All Locale Files

In `public/locales/en/translation.json`:

```json
{
  "myComponent": {
    "title": "My Component Title",
    "description": "This is my component description"
  }
}
```

In `public/locales/es/translation.json`:

```json
{
  "myComponent": {
    "title": "Título de Mi Componente",
    "description": "Esta es la descripción de mi componente"
  }
}
```

### 3. Complex Component with Multiple Features

```tsx
import { useState } from 'react'
import { useTranslation } from 'react-i18next'
import { toast } from 'sonner'

export function UserManagement() {
  const { t } = useTranslation()
  const [loading, setLoading] = useState(false)

  const handleSave = async () => {
    setLoading(true)
    try {
      // Save logic here
      toast.success(t('user.saveSuccess'))
    } catch (error) {
      toast.error(t('user.saveError'))
    } finally {
      setLoading(false)
    }
  }

  return (
    <div>
      <h1>{t('user.management.title')}</h1>
      
      <button onClick={handleSave} disabled={loading}>
        {loading ? t('common.loading') : t('common.save')}
      </button>
      
      <div className="status">
        {loading && t('user.saving')}
      </div>
    </div>
  )
}
```

## Creating New Pages with i18n

### 1. Page Component Template

```tsx
import { useTranslation } from 'react-i18next'
import { Helmet } from 'react-helmet-async'

export function AboutPage() {
  const { t } = useTranslation()

  return (
    <>
      <Helmet>
        <title>{t('about.pageTitle')}</title>
        <meta name="description" content={t('about.pageDescription')} />
      </Helmet>
      
      <div className="container mx-auto px-4 py-8">
        <h1>{t('about.title')}</h1>
        <p>{t('about.introduction')}</p>
        
        <section>
          <h2>{t('about.mission.title')}</h2>
          <p>{t('about.mission.description')}</p>
        </section>
      </div>
    </>
  )
}
```

### 2. Add Page Translations

```json
{
  "about": {
    "pageTitle": "About Us - Your App Name",
    "pageDescription": "Learn more about our company and mission",
    "title": "About Us",
    "introduction": "Welcome to our company...",
    "mission": {
      "title": "Our Mission",
      "description": "We strive to..."
    }
  }
}
```

### 3. Dynamic Route with i18n

```tsx
import { useParams } from '@tanstack/react-router'
import { useTranslation } from 'react-i18next'

export function ProductDetailPage() {
  const { productId } = useParams()
  const { t } = useTranslation()

  return (
    <div>
      <h1>{t('product.details.title', { id: productId })}</h1>
      <p>{t('product.details.description')}</p>
    </div>
  )
}
```

## Advanced Patterns

### 1. Namespaces (Multiple Translation Files)

```typescript
// i18n.ts configuration with namespaces
i18n.init({
  ns: ['translation', 'validation', 'errors'],
  defaultNS: 'translation',
  // ... other config
})
```

Usage in components:

```tsx
const { t } = useTranslation(['translation', 'validation'])

// Use specific namespace
t('validation:emailRequired')
t('errors:networkError')
```

### 2. Lazy Loading Translations

```tsx
import { Suspense } from 'react'
import { useTranslation } from 'react-i18next'

function MyLazyComponent() {
  const { t, ready } = useTranslation()

  if (!ready) return <div>Loading translations...</div>

  return <div>{t('myComponent.title')}</div>
}

export function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <MyLazyComponent />
    </Suspense>
  )
}
```

### 3. Format Numbers and Dates

```tsx
import { useTranslation } from 'react-i18next'

export function LocalizedContent() {
  const { t, i18n } = useTranslation()

  const formatPrice = (amount: number) => {
    return new Intl.NumberFormat(i18n.language, {
      style: 'currency',
      currency: 'USD'
    }).format(amount)
  }

  const formatDate = (date: Date) => {
    return new Intl.DateTimeFormat(i18n.language).format(date)
  }

  return (
    <div>
      <p>{t('product.price')}: {formatPrice(29.99)}</p>
      <p>{t('product.releaseDate')}: {formatDate(new Date())}</p>
    </div>
  )
}
```

### 4. Pluralization

```tsx
import { useTranslation } from 'react-i18next'

export function ItemCounter({ count }: { count: number }) {
  const { t } = useTranslation()

  return (
    <div>
      {t('items.count', { count, defaultValue_one: '{{count}} item', defaultValue_other: '{{count}} items' })}
    </div>
  )
}
```

Translation file structure for pluralization:

```json
{
  "items": {
    "count_one": "{{count}} item",
    "count_other": "{{count}} items"
  }
}
```

## Adding New Languages

### 1. Create Translation Files

Create new translation files in `public/locales/`:

```bash
mkdir public/locales/ja
touch public/locales/ja/translation.json
```

### 2. Add Complete Translations

Copy the structure from `en/translation.json` and translate all values:

```json
{
  "navigation": {
    "dashboard": "ダッシュボード",
    "organizations": "組織"
  },
  "auth": {
    "email": "メールアドレス",
    "password": "パスワード"
  }
}
```

### 3. Update Language Switcher

```tsx
export function LanguageSwitcher() {
  const { i18n } = useTranslation()

  const languages = [
    { code: 'en', name: 'English' },
    { code: 'es', name: 'Español' },
    { code: 'fr', name: 'Français' },
    { code: 'de', name: 'Deutsch' },
    { code: 'pt', name: 'Português' },
    { code: 'ja', name: '日本語' }, // Add new language
  ]

  return (
    <select 
      value={i18n.language} 
      onChange={(e) => i18n.changeLanguage(e.target.value)}
    >
      {languages.map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.name}
        </option>
      ))}
    </select>
  )
}
```

## Translation Key Organization

### Recommended Key Structure

```text
feature.component.element
```

Examples:

```json
{
  "auth.signIn.title": "Sign In",
  "auth.signIn.submitButton": "Sign In",
  "auth.signUp.title": "Create Account",
  "dashboard.stats.totalUsers": "Total Users",
  "settings.profile.updateButton": "Update Profile"
}
```

### Common Categories

```json
{
  "navigation": {}, // Navigation menu items
  "auth": {},        // Authentication related
  "common": {},      // Shared UI elements
  "errors": {},      // Error messages
  "validation": {},  // Form validation
  "dashboard": {},   // Dashboard specific
  "settings": {},    // Settings page
  "organizations": {}, // Organization management
  "billing": {}      // Billing and payments
}
```

## Form Integration

### React Hook Form with Validation

```tsx
import { z } from 'zod'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { useTranslation } from 'react-i18next'
import { Form, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form'

export function ContactForm() {
  const { t } = useTranslation()

  const formSchema = z.object({
    name: z.string().min(1, t('validation.nameRequired')),
    email: z.string().email(t('validation.emailInvalid')),
    message: z.string().min(10, t('validation.messageMinLength'))
  })

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema)
  })

  const onSubmit = (values: z.infer<typeof formSchema>) => {
    // Handle form submission
    console.log(values)
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)}>
        <FormField
          control={form.control}
          name="name"
          render={({ field }) => (
            <FormItem>
              <FormLabel>{t('contact.form.name')}</FormLabel>
              <FormControl>
                <Input 
                  placeholder={t('contact.form.namePlaceholder')} 
                  {...field} 
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <Button type="submit">
          {t('contact.form.submit')}
        </Button>
      </form>
    </Form>
  )
}
```

## Error Handling with i18n

### API Error Messages

```tsx
import { useTranslation } from 'react-i18next'
import { toast } from 'sonner'

export function useApiErrorHandler() {
  const { t } = useTranslation()

  const handleError = (error: any) => {
    const errorCode = error?.response?.data?.code || 'unknown'
    const errorMessage = t(`errors.api.${errorCode}`, {
      defaultValue: t('errors.api.generic')
    })
    
    toast.error(errorMessage)
  }

  return { handleError }
}
```

Error translations:

```json
{
  "errors": {
    "api": {
      "generic": "An error occurred. Please try again.",
      "network": "Network error. Check your connection.",
      "unauthorized": "You are not authorized to perform this action.",
      "forbidden": "Access denied.",
      "notFound": "The requested resource was not found.",
      "validationError": "Please check your input and try again."
    }
  }
}
```

## Testing i18n Components

### Jest Testing

```tsx
import { render, screen } from '@testing-library/react'
import { I18nextProvider } from 'react-i18next'
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import { MyComponent } from './MyComponent'

// Setup test i18n instance
i18n.use(initReactI18next).init({
  lng: 'en',
  fallbackLng: 'en',
  resources: {
    en: {
      translation: {
        'myComponent.title': 'Test Title'
      }
    }
  }
})

const renderWithI18n = (component: React.ReactElement) => {
  return render(
    <I18nextProvider i18n={i18n}>
      {component}
    </I18nextProvider>
  )
}

test('renders translated text', () => {
  renderWithI18n(<MyComponent />)
  expect(screen.getByText('Test Title')).toBeInTheDocument()
})
```

## Performance Optimization

### Bundle Splitting for Translations

```typescript
// i18n.ts
i18n.init({
  backend: {
    loadPath: '/locales/{{lng}}/{{ns}}.json',
    allowMultiLoading: false, // Load one namespace at a time
  },
  // Only load current language
  preload: [], // Don't preload languages
})
```

### Lazy Loading Components

```tsx
import { lazy, Suspense } from 'react'
import { useTranslation } from 'react-i18next'

const LazyAdminPanel = lazy(() => import('./AdminPanel'))

export function App() {
  const { t } = useTranslation()

  return (
    <Suspense fallback={<div>{t('common.loading')}</div>}>
      <LazyAdminPanel />
    </Suspense>
  )
}
```

## Best Practices

### 1. Key Naming Conventions

- Use lowercase with dots for hierarchy: `auth.form.emailLabel`
- Be descriptive: `button.save` not `btn.sv`
- Group related keys: `validation.email.required`, `validation.email.invalid`

### 2. Variable Handling

```tsx
// Good: Clear variable names
t('welcome.message', { userName: 'John', loginCount: 5 })

// Bad: Unclear variables
t('welcome.message', { u: 'John', c: 5 })
```


### 3. Default Values (Required)

```tsx
// Always provide a default text as the second argument
t('feature.newKey', 'Default text for new feature')
```

### 4. Avoid Hardcoded Text


```tsx
// Bad
<button>Save</button>

// Good (with default text)
<button>{t('common.save', 'Save')}</button>
```

### 5. Context-Specific Translations

```tsx
// Different contexts might need different translations
t('button.save.form')     // "Save"
t('button.save.document') // "Save Document"
t('button.save.draft')    // "Save as Draft"
```


## Robust Fallback Handling

All translation usages in the codebase are required to provide a default text argument. This ensures:

- No UI text will be missing if a translation key is absent.
- Developers and testers always see meaningful fallback text during development.
- The app is robust to incomplete or missing translation files.

If you see a translation call without a default text, update it to include one as the second argument.

## Troubleshooting

### Common Issues

1. **Translation not updating**: Clear localStorage and refresh
2. **Missing translations**: With default text, UI will show fallback; check console for missing key warnings
3. **Interpolation not working**: Ensure variables are passed correctly
4. **Language not persisting**: Check localStorage implementation

### Debug Mode

Enable debug mode in development:

```typescript
i18n.init({
  debug: import.meta.env.DEV,
  // ... other config
})
```

This will log missing translations and other helpful information to the console.

This documentation provides a complete guide for implementing and extending the i18n system in your React frontend with TypeScript. All translation usages must now include a default text for robust fallback.